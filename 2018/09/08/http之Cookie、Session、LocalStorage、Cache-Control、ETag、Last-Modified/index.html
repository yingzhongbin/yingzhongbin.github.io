<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified | 应忠彬的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="笔记摘要cookie session cache-control都是响应头 请求体GET /xxx HTTP/1.1Host:xxx.com 响应体HTTP/1.1 200 okContent-Type:text/html;charset=utf8Content-Length:100b   js发送请求代码123456789var request = new XMLHttpRequest()req">
<meta property="og:type" content="article">
<meta property="og:title" content="http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified">
<meta property="og:url" content="http://yoursite.com/2018/09/08/http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified/index.html">
<meta property="og:site_name" content="应忠彬的博客">
<meta property="og:description" content="笔记摘要cookie session cache-control都是响应头 请求体GET /xxx HTTP/1.1Host:xxx.com 响应体HTTP/1.1 200 okContent-Type:text/html;charset=utf8Content-Length:100b   js发送请求代码123456789var request = new XMLHttpRequest()req">
<meta property="og:updated_time" content="2018-09-08T08:29:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified">
<meta name="twitter:description" content="笔记摘要cookie session cache-control都是响应头 请求体GET /xxx HTTP/1.1Host:xxx.com 响应体HTTP/1.1 200 okContent-Type:text/html;charset=utf8Content-Length:100b   js发送请求代码123456789var request = new XMLHttpRequest()req">
  
    <link rel="alternate" href="/atom.xml" title="应忠彬的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">应忠彬的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/08/http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified/" class="article-date">
  <time datetime="2018-09-08T07:54:04.000Z" itemprop="datePublished">2018-09-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="笔记摘要"><a href="#笔记摘要" class="headerlink" title="笔记摘要"></a>笔记摘要</h3><p>cookie session cache-control都是响应头</p>
<h5 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h5><p>GET /xxx HTTP/1.1<br>Host:xxx.com</p>
<h5 id="响应体"><a href="#响应体" class="headerlink" title="响应体"></a>响应体</h5><p>HTTP/1.1 200 ok<br>Content-Type:text/html;charset=utf8<br>Content-Length:100b  </p>
<h6 id="js发送请求代码"><a href="#js发送请求代码" class="headerlink" title="js发送请求代码"></a>js发送请求代码</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var request = new XMLHttpRequest()</span><br><span class="line">request.open(“POST”,’/xxx’)</span><br><span class="line">request.onreadystatechange = function()&#123;</span><br><span class="line">	if(request.readyState === 4 &amp;&amp; request.status ===200)&#123;</span><br><span class="line">		响应成功</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">// 发送请求</span><br><span class="line"> request.send(“a=1&amp;b=2”)</span><br></pre></td></tr></table></figure>
<p>cookie就是入门票  每来一次都要出示一次</p>
<h3 id="Cookie特点"><a href="#Cookie特点" class="headerlink" title="Cookie特点"></a>Cookie特点</h3><p>1.服务器通过Set-Cookie 响应头设置Cookie<br>2.浏览器得到Cookie之后，每次请求都要带上Cookie<br>3.服务器读取Cookie就知道登录用户的信息  </p>
<h6 id="Cookie相关问题"><a href="#Cookie相关问题" class="headerlink" title="Cookie相关问题"></a>Cookie相关问题</h6><p>1.我在Chrome登录了得到Cookie，用Safar访问，Safari会带上Cookie吗<br>NO  </p>
<p>2.Cookie存在哪？<br>存在系统的一个文件里 </p>
<p>3.Cookie能作假吗？<br>可以    </p>
<p>4.Cookie有有效期吗？<br>默认有效期20分钟左右,后端可以强制设置有效期  </p>
<h4 id="登录注册的Cookie设定过程"><a href="#登录注册的Cookie设定过程" class="headerlink" title="登录注册的Cookie设定过程"></a>登录注册的Cookie设定过程</h4><table>
<thead>
<tr>
<th>服务器</th>
<th>过程</th>
<th>用户</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td>开始注册</td>
</tr>
<tr>
<td></td>
<td>&lt;==发送POST请求，数据为email,passpword,password_confirm</td>
<td></td>
</tr>
<tr>
<td>将数据email，passpword写入数据库</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>注册成功 ==&gt;</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>开始登录</td>
</tr>
<tr>
<td></td>
<td>&lt;==发送POST请求，数据为email,passpword</td>
<td></td>
</tr>
<tr>
<td>验证成功</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>SetCookie 数据为email ==&gt;</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>打开首页</td>
</tr>
<tr>
<td></td>
<td>&lt;==发送GET请求，会带上Cookie里的数据email</td>
<td></td>
</tr>
<tr>
<td>读取Cookie里的数据email，找到数据库里的用户信息，返回index.html,并将index.html里需要的用户信息替换掉</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>使用Cookie过程<br>1.Set-Cookie<br>2.每次请求相同域名时带上Cookie  </p>
<p>用途：<br>登录成功</p>
<p>电脑上设置了Cookie，每次访问首页时，会带上Cookie发送请求。<br>服务器读取Cookie。如果有信息，去数据库寻找用户信息返回。</p>
<p>Cookie有一个缺点，可以被篡改。所以就引入了session</p>
<p>什么是Session?<br>服务器通过Cookie给用户一个sessionId，sessionId对应服务器里的一小块内存。每次用户访问服务器时，服务器就通过sessionId读取对应的Session，得到用户的隐私信息。</p>
<p>Cookie  </p>
<ol>
<li>服务器通过 Set-Cookie 头给客户端一串字符串  </li>
<li>客户端每次访问相同域名的网页时，必须带上这段字符串  </li>
<li>客户端要在一段时间内保存这个Cookie  </li>
<li>Cookie 默认在用户关闭页面后就失效，后台代码可以任意设置 Cookie 的过期时间  </li>
<li>大小大概在 4kb 以内 </li>
</ol>
<p>Session（不翻译）  </p>
<ol>
<li>将 SessionID（随机数）通过 Cookie 发给客户端  </li>
<li>客户端访问服务器时，服务器读取 SessionID  </li>
<li>服务器有一块内存（哈希表）保存了所有 session  </li>
<li>通过 SessionID 我们可以得到对应用户的隐私信息，如 id、email  </li>
<li>这块内存（哈希表）就是服务器上的所有 session </li>
</ol>
<p>LocalStorage    </p>
<ol>
<li>LocalStorage 跟 HTTP 无关  </li>
<li>HTTP 不会带上 LocalStorage 的值  </li>
<li>只有相同域名的页面才能互相读取 LocalStorage（没有同源那么严格）  </li>
<li>每个域名 localStorage 最大存储量为 5Mb 左右（每个浏览器不一样）  </li>
<li>常用场景：记录有没有提示过用户（没有用的信息，不能记录密码）  </li>
<li>LocalStorage 永久有效，除非用户清理缓存  </li>
</ol>
<p>SessionStorage（会话存储）  </p>
<ol>
<li>1、2、3、4 同上    </li>
<li>5：SessionStorage 在用户关闭页面（会话结束）后就失效。</li>
</ol>
<p>localStorage是持久化存储，用户不清空，不会过期<br>localStorage是html5里的API</p>
<h6 id="localStorage-API"><a href="#localStorage-API" class="headerlink" title="localStorage API"></a>localStorage API</h6><p>localStorage.setItem(key,value)<br>localStorage.getItem(key)<br>localStorage.clear()  </p>
<h6 id="sessionStorage-API"><a href="#sessionStorage-API" class="headerlink" title="sessionStorage API"></a>sessionStorage API</h6><p>sessionStorage.setItem(key,value)<br>sessionStorage.getItem(key)<br>sessionStorage.removeItem(key)  </p>
<h6 id="Cookie-Session什么关系？"><a href="#Cookie-Session什么关系？" class="headerlink" title="Cookie Session什么关系？"></a>Cookie Session什么关系？</h6><p>Session是基于Cookie实现的<br>Cookie localStorage有什么区别？<br>Cookie会被发送给服务器，localStorage不会。<br>localStorage SessionStorage什么区别  </p>
<p>session 也可以通过查询参数和localStorage来设置</p>
<p>前端永远不要读、写Cookie</p>
<h6 id="缓存控制-Cache-Control，设置后用户可以直接从缓存中读取文件，不发起请求"><a href="#缓存控制-Cache-Control，设置后用户可以直接从缓存中读取文件，不发起请求" class="headerlink" title="缓存控制 Cache-Control，设置后用户可以直接从缓存中读取文件，不发起请求"></a>缓存控制 Cache-Control，设置后用户可以直接从缓存中读取文件，<em>不发起请求</em></h6><table>
<thead>
<tr>
<th>服务器</th>
<th>过程</th>
<th>用户</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>&lt;==发送请求，请求文件main.js</td>
<td></td>
</tr>
<tr>
<td></td>
<td>返回main.js文件 以及响应头max-age:30 ==&gt;</td>
<td></td>
</tr>
<tr>
<td></td>
<td>&lt;==同样的url请求（没有发送请求）</td>
<td></td>
</tr>
<tr>
<td></td>
<td>==&gt;从内存里读取上一次的main.js</td>
<td></td>
</tr>
<tr>
<td></td>
<td>&lt;==过了30秒，发送请求，请求文件main.js</td>
<td></td>
</tr>
<tr>
<td></td>
<td>返回main.js文件 以及响应头max-age:30 ==&gt;</td>
<td></td>
</tr>
</tbody>
</table>
<p><code>response.setHeader(“Cache-Control”,”max-age=30”)//30秒内不需要再次请求，内容直接从缓存里读取</code></p>
<p>首页不允许设置缓存。<br>只有相同的url才会利用上次的缓存，所以，如果文件更新了，设置一个查询参数就可以了。<br>href=“default.css?v=2”  </p>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>从前使用 Expires<br>现在使用 Cache-Control<br><code>response.setHeader(“Expires”,”未来的格林威治时间点”)</code><br>它是与用户的本地时间进行对比的，如果用户本地时间错乱，那就有问题了。  </p>
<h3 id="ETag-直接不下载（有请求）"><a href="#ETag-直接不下载（有请求）" class="headerlink" title="ETag  直接不下载（有请求）"></a>ETag  直接不下载（有请求）</h3><p>MD5消息摘要算法（英语：MD5 Message-Digest Algorithm），一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。<br>http  304 Not Modified</p>
<p>node.js代码<br><code>`
let fileMd5 = md5(file)
response.setHeader(“ETag”,fileMd5)
if(request.headers[‘if-none-match’] === fileMd5){
    //没有响应体
    response.statusCode = 304
}else{
    response.write(file)
}
response.end()</code></p>
<h3 id="Last-Modified"><a href="#Last-Modified" class="headerlink" title="Last-Modified"></a>Last-Modified</h3><p>在浏览器第一次请求某一个URL时，服务器端的返回状态会是200，内容是客户端请求的资源，同时有一个Last-Modified的属性标记此文件在服务器端最后被修改的时间。</p>
<h6 id="Last-Modified格式类似这样："><a href="#Last-Modified格式类似这样：" class="headerlink" title="Last-Modified格式类似这样："></a>Last-Modified格式类似这样：</h6><p>Last-Modified : Fri , 12 May 2006 18:53:33 GMT<br>客户端第二次请求此URL时，根据HTTP协议的规定，浏览器会向服务器传送If-Modified-Since报头，询问该时间之后文件是否有被修改过：<br>If-Modified-Since : Fri , 12 May 2006 18:53:33 GMT<br>如果服务器端的资源没有变化，则自动返回 HTTP 304（Not Changed.）状态码，内容为空，这样就节省了传输数据量。  </p>
<p>从资源更新原理来看Last-Modified和Etag基本是类似的，那为什么http协议中要搞2个标识呢？<br>Last-Modified存在的问题：<br>1、在集群服务器上各个服务器上的文件时间可能不同。<br>2、如果用旧文件覆盖新文件，因为时间更前，浏览器不会请求这个更旧的文件。<br>3、时间精度为s级，对文件修改精度有严格要求的场景不能满足  </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/09/08/http之Cookie、Session、LocalStorage、Cache-Control、ETag、Last-Modified/" data-id="cjnbiv3nh000fdcf4kxdjbsy4" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/09/28/flex布局下flex-grow部分的文字超过部分显示为省略号的方法和解释/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          flex布局下flex-grow部分的文字超过部分显示为省略号的方法和解释
        
      </div>
    </a>
  
  
    <a href="/2018/08/11/路由/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Älter</strong>
      <div class="article-nav-title">路由</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/10/15/JS模拟继承/">JS模拟继承</a>
          </li>
        
          <li>
            <a href="/2018/10/13/你真的懂函数吗？/">你真的懂函数吗？</a>
          </li>
        
          <li>
            <a href="/2018/10/09/TypeScript学习笔记/">(no title)</a>
          </li>
        
          <li>
            <a href="/2018/10/06/ES6/">ES6</a>
          </li>
        
          <li>
            <a href="/2018/10/06/vue学习笔记/">vue学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 应忠彬<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>